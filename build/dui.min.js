define("format",[],function(){return{money:function(e){return e},"int":function(e){return e},"float":function(e){return e},time:function(e,t){return e}}}),define("data/errcode",[],function(){return{1:"cannot find container to render"}}),define("error",["./data/errcode"],function(e){function t(t){var n="unkonw error";throw typeof e[t]!="undefined"&&(n=e[t]),new Error(n)}return t}),define("dom",["jquery"],function(e){function t(){this.init.apply(this,arguments)}return t.get=function(n){var r=e(n);return r.length==0?null:new t(r)},t.prototype={init:function(t){return typeof t=="string"?this.dom=e("<"+t+"></"+t+">"):this.dom=t,this},addClass:function(e){return this.dom.addClass(e),this},removeClass:function(e){return this.dom.removeClass(e),this},css:function(e){return this.dom.css(e),this},attr:function(e,t){return this.dom.attr(e,t),this},text:function(e){return this.dom.text(e),this},append:function(e){return this.dom.append(e.dom),this},prepend:function(e){return this.dom.prepend(e.dom),this},html:function(e){return this.dom.html(e.dom),this},empty:function(){return this.dom.empty(),this},bind:function(e,t){return this.dom.bind(e,t),this},children:function(e){return t.get(this.dom.children().eq(e))},hide:function(){return this.dom.hide(),this},show:function(){return this.dom.show(),this}},t}),define("data/css",[],function(){return{table:{th:{sort:{desc:"order-down",asc:"order-up"}}}}}),define("data/var",[],function(){return{sort:{desc:1,asc:-1},defaultVar:"-",sum:{text:"合计",valign:{top:"top",bottom:"bottom"}}}}),define("core",["./format","./error","./dom","./data/css","./data/var"],function(e,t,n,r,i){var s=function(){};return s.extend=s.prototype.extend=function(e){for(var t in e)this[t]=e[t]},s.extend({dom:n,css:r,"var":i,error:t,format:e,isArray:Array.isArray,inArray:function(e,t){return s.isArray(t)?t.indexOf(e)>=0?!0:!1:!1},isNumber:function(e){return!s.isArray(e)&&e-parseFloat(e)+1>=0},isString:function(e){return toString.call(e)==="[object String]"},isObject:function(e){return toString.call(e)==="[object Object]"},isNaN:function(e){return!s.isString(e)&&!s.isObject(e)&&!s.isArray(e)&&isNaN(e)}}),s}),define("widget/ajax",["../core","jquery"],function(e,t){var n=function(e,n,r,i){i=i||5e3,t.ajax({type:"GET",url:e,timeout:i,dataType:"json",success:function(e){typeof n=="function"&&n(e)},error:function(){typeof r=="function"&&r()}})},r=function(e,n,r,i,s){s=s||5e3,t.ajax({type:"POST",url:e,timeout:s,dataType:"json",data:n,success:function(e){typeof r=="function"&&r(e)},error:function(){typeof i=="function"&&i()}})};return e.extend({ajax:{get:n,post:r}}),e}),define("widget/table/head",["../../core"],function(e){function t(){this.init.apply(this,arguments)}return t.prototype={init:function(t,n){var r=this;r.table=t,r.field=[],r.fieldGroupMap=[],r.fieldGroupCnt=[];var i=0;for(var s in n){var o=-1;if(typeof n[s].fieldGroup!="undefined"){var u=Math.max(r.fieldGroupMap.length-1,0);i>0&&r.field[i-1].groupId==u&&r.fieldGroupMap[u]==n[s].fieldGroup?(r.fieldGroupCnt[u]++,o=u):(r.fieldGroupMap.push(n[s].fieldGroup),r.fieldGroupCnt.push(1),o=r.fieldGroupMap.length-1)}r.field.push({idx:i,text:n[s].text||"",sortable:n[s].sortable||!1,order:e.var.sort.asc,width:n[s].width||100,groupId:o}),i++}r.isFieldGroup=r.fieldGroupMap.length>0},render:function(t){var n=this,r=new e.dom("colgroup"),i=new e.dom("thead"),s=new e.dom("tr"),o=new e.dom("tr"),u=[];for(var a in n.field){var f=new e.dom("col");f.attr("width",n.field[a].width),r.append(f);var l=new e.dom("th");l.text(n.field[a].text);if(n.isFieldGroup)if(n.field[a].groupId>=0){o.append(l);var c=n.field[a].groupId;if(!e.inArray(c,u)){u.push(c);var h=new e.dom("th");h.attr("colspan",n.fieldGroupCnt[c]).text(n.fieldGroupMap[c]),s.append(h)}}else l.attr("rowspan",2),s.append(l);else o.append(l);n.field[a].dom=l,n.bindEvent(a)}n.isFieldGroup&&i.append(s),i.append(o),t.append(r),t.append(i)},bindEvent:function(t){var n=this,r=n.field[t];r.sortable&&r.dom.bind("click",function(){var i=e.css.table.th.sort[r.ord];r.ord=r.ord==e.var.sort.asc?e.var.sort.desc:e.var.sort.asc;var s=e.css.table.th.sort[r.ord];r.dom.removeClass(i).addClass(s),n.table.body.sort(t,r.ord)})}},t}),define("widget/table/func",["../../core"],function(e){return{sortTr:function(e,t,n){e.sort(function(e,r){return e.row[t].num==r.row[t].num?0:e.row[t].num>r.row[t].num?n:-n})},createTr:function(t){var n=new e.dom("tr");for(var r in t){var i=new e.dom("td");i.text(t[r].format),n.append(i)}return n},formatRow:function(t,n){var r=[];for(var i in n){var s=e.var.defaultVar;typeof n[i].formula=="function"?s=n[i].formula(t):typeof t[n[i].dataIndex]!="undefined"&&(s=t[n[i].dataIndex]),e.isNaN(s)&&(s=e.var.defaultVar);var o=s;s!==e.var.defaultVar&&typeof n[i].format=="function"&&(o=n[i].format(s)),s===e.var.defaultVar&&(s=0),r.push({format:o,num:s})}return r},formatSum:function(t,n){var r=[];for(var i in n){var s=e.var.defaultVar;if(n[i].isSum){typeof n[i].formula=="function"?s=n[i].formula(t):typeof t[n[i].dataIndex]!="undefined"&&(s=t[n[i].dataIndex]),e.isNaN(s)&&(s=e.var.defaultVar);var o=s;s!==e.var.defaultVar&&typeof n[i].format=="function"&&(o=n[i].format(s))}else var o=s;r.push({format:o,num:s})}return r}}}),define("widget/table/body/lineal",["../../../core","../func"],function(e,t){function n(){this.init.apply(this,arguments)}return n.prototype={init:function(n){var r=this;r.field=n.field,r.sum=n.sum,r.data=[],r.sumData={row:{}},r.sumData.row[n.field[0].dataIndex]=n.sum.text;var i={};for(var s in n.data){r.data.push({row:t.formatRow(n.data[s],r.field)});for(var o in n.data[s])r.sum.is&&e.isNumber(n.data[s][o])&&(i[o]=i[o]||0,i[o]+=n.data[s][o])}for(var s in r.data){var u=t.createTr(r.data[s].row);r.data[s].dom=u}r.sum.is&&(i[r.field[r.sum.fieldIndex].dataIndex]=n.sum.text,r.sumData.row=t.formatSum(i,r.field),r.sumData.dom=t.createTr(r.sumData.row))},render:function(e){var t=this;for(var n in t.data)e.append(t.data[n].dom);t.renderSum(e)},renderSum:function(e){var t=this;if(!t.sum.is)return;t.sum.valign==="top"?e.prepend(t.sumData.dom):e.append(t.sumData.dom)},sort:function(e,n){t.sortTr(this.data,e,n)},numSwitch:function(t){var n=this;for(var r in n.field){if(!n.field[r].numSwitch)continue;for(var i in n.data){if(n.data[i].row[r].format==e.var.defaultVar)continue;n.data[i].dom.children(r).text(n.data[i].row[r][t])}n.sum.is&&n.sumData.row[r].format!==e.var.defaultVar&&n.sumData.dom.children(r).text(n.sumData.row[r][t])}}},n}),define("widget/table/body/grouped",["../../../core","../func"],function(e,t){function n(){this.init.apply(this,arguments)}return n.prototype={init:function(n){var r=this;r.field=n.field,r.group=n.group,r.sum=n.sum,r.data=[],r.sumData={};var i=[],s={};for(var o in n.data){var u=n.data[o][r.group.dataIndex],a=i.indexOf(u);a<0&&(i.push(u),a=i.length-1,r.data[a]={row:{},sub:[],open:!1},r.data[a].row[r.group.fieldIndex]=u);var f=t.formatRow(n.data[o],r.field);r.data[a].sub.push({row:f,dom:t.createTr(f)});for(var l in n.data[o]){if(!e.isNumber(n.data[o][l]))continue;l!==r.group.fieldIndex&&(r.data[a].row[l]=r.data[a].row[l]||0,r.data[a].row[l]+=n.data[o][l]),r.sum.is&&e.isNumber(n.data[o][l])&&(s[l]=s[l]||0,s[l]+=n.data[o][l])}}for(var o in r.data)r.data[o].row=t.formatRow(r.data[o].row,r.field),r.data[o].dom=t.createTr(r.data[o].row),r.bindOpenEvent(r.data[o]);r.sum.is&&(s[r.field[r.sum.fieldIndex].dataIndex]=n.sum.text,r.sumData.row=t.formatSum(s,r.field),r.sumData.dom=t.createTr(r.sumData.row))},render:function(e){var t=this;for(var n in t.data){e.append(t.data[n].dom);for(var r in t.data[n].sub)t.data[n].open?t.data[n].sub[r].dom.show():t.data[n].sub[r].dom.hide(),e.append(t.data[n].sub[r].dom)}t.renderSum(e)},renderSum:function(e){var t=this;if(!t.sum.is)return;t.sum.valign==="top"?e.prepend(t.sumData.dom):e.append(t.sumData.dom)},sort:function(e,n){var r=this;t.sortTr(r.data,e,n);for(var i in r.data)t.sortTr(r.data[i].sub,e,n)},numSwitch:function(t){var n=this;for(var r in n.field){if(!n.field[r].numSwitch)continue;for(var i in n.data){if(n.data[i].row[r].format==e.var.defaultVar)continue;n.data[i].dom.children(r).text(n.data[i].row[r][t]);for(var s in n.data[i].sub){if(n.data[i].sub[s].row[r].format==e.var.defaultVar)continue;n.data[i].sub[s].dom.children(r).text(n.data[i].sub[s].row[r][t])}}n.sum.is&&n.sumData.row[r].format!==e.var.defaultVar&&n.sumData.dom.children(r).text(n.sumData.row[r][t])}},bindOpenEvent:function(e){var t=this;e.dom.bind("click",function(t){e.open=e.open==0?!0:!1;for(var n in e.sub)e.open?e.sub[n].dom.show():e.sub[n].dom.hide()})}},n}),define("widget/table/body/body",["../../../core","./lineal","./grouped"],function(e,t,n){function r(){this.init.apply(this,arguments)}return r.prototype={init:function(r,i){var s=this;s.table=r,s.tbody=new e.dom("tbody"),s.impl=null;var o={text:e.var.sum.text,valign:e.var.sum.valign.bottom,fieldIndex:0,is:!1},u={fieldIndex:null,dataIndex:null},a=[];e.isObject(i.sum)&&(o.text=i.sum.text||o.text,o.valign=i.sum.valign||o.valign,o.fieldIndex=i.sum.fieldIndex||o.fieldIndex);for(var f in i.field){var l={numSwitch:i.field[f].numSwitch||!1,format:i.field[f].format||!1,formula:i.field[f].formula||!1,dataIndex:i.field[f].dataIndex,isSum:i.field[f].isSum||!1};a.push(l),l.isSum&&(o.is=!0)}o.is&&(a[o.fieldIndex].isSum=!0);var c=!1;if(e.isObject(i.dataGroup)){var h=i.dataGroup.fieldIndex||0;e.isNumber(h)&&e.isString(i.dataGroup.dataIndex)&&e.isObject(i.field[h])&&(c=!0,u.fieldIndex=i.field[h].dataIndex,u.dataIndex=i.dataGroup.dataIndex)}var p={field:a,sum:o,data:i.data};c?(p.group=u,s.impl=new n(p)):s.impl=new t(p)},render:function(e){var t=this;t.tbody.empty(),t.impl.render(t.tbody),e.append(t.tbody)},sort:function(e,t){var n=this;n.impl.sort(e,t),n.impl.render(n.tbody)},numSwitch:function(e){this.impl.numSwitch(e)}},r}),define("widget/table/toolbar/toolbar",["../../../core"],function(e){var t=function(){this.init.apply(this,arguments)};return t.prototype={init:function(e,t){var n=this;n.table=e,n.isSwitch=!1,n.switchStat="format";for(var r in t)if(t[r].numSwitch||!1){n.isSwitch=!0;break}},render:function(t){var n=this,r=new e.dom("a");r.text("switch"),r.bind("click",function(){n.switchStat=n.switchStat=="num"?"format":"num",n.table.body.numSwitch(n.switchStat)}),t.append(r)}},t}),define("widget/table/table",["../../core","./head","./body/body","./toolbar/toolbar"],function(e,t,n,r){function i(){this.init.apply(this,arguments)}return i.prototype={init:function(i,s){var o=this;o.box=e.dom.get(i),o.box===null&&e.error(1),o.dom={},o.dom.toolbar=new e.dom("div"),o.dom.table=new e.dom("table"),o.toolbar=new r(o,s.field),o.head=new t(o,s.field),o.body=new n(o,s)},render:function(){var e=this;e.toolbar.render(e.dom.toolbar),e.head.render(e.dom.table),e.body.render(e.dom.table),e.box.append(e.dom.toolbar),e.box.append(e.dom.table)}},e.extend({table:i}),e}),define("dui",["./core","./widget/ajax","./widget/table/table"],function(e){return e});